%% aps to author template--please use pdflatex to edit then to pdf--------------
\documentclass[A4,twoside,fontset=ubuntu,UTF8]{ctexart}
%\usepackage{slashbox}\usepackage{makecell}\usepackage{diagbox}\backslashbox
\usepackage{aappss}
%\usepackage{epstopdf}

\newcommand{\vx}{{\mathbf{x}}}
%\renewcommand\baselinestretch{1.235}\protect
\renewcommand\baselinestretch{2.0}\protect
\abovedisplayshortskip 0 pt plus 3pt
\belowdisplayshortskip 6 pt plus 2pt minus 2pt
\abovedisplayskip 6 pt plus 2pt minus 2pt
\belowdisplayskip 6 pt plus 2pt minus 2pt
% \info{2015}{64}{1}{01{}} \infodate{2015.0.0.}{2015.0.0.}
%=================== Text begin here ==============================
\begin{document}\apsname

\title{自动微分理论 \fivestar}%{\cfundlink}

\author{刘金国$^{1)}$ \quad 许开来$^{2)}$}

\address{1)}{哈佛大学物理系, 坎布里奇 \quad 02138}

%\address{3)}{}

\abstract{自动微分是机器学习中核心的数值技术，它被用于高效，自动的对程序求导。
如今越来越多的物理学者意识到高效，自动的求导可以对很多物理问题的求解提供新的思路。
本文介绍自动微分技术相关的主要理论，以及若干再物理中的应用。}

\keywords{自动微分，科学计算，编程语言}

% https://ufn.ru/en/pacs/all/
% 02.60.Pn numerical optimization
% 02.30.Jr Partial differential equations
\pacs{02.60.Pn, 02.30.Jr}

\cfund{}

\cmail{jinguoliu@g.harvard.edu \quad }

%\cmailddag{mail2}

%\mail{}{}\cmail \cmailddag

%\apscopyright \baselineskip=16.0pt plus.2pt minus.2pt
%\begin{multicols}{2}\sec
\vskip 0.55\baselineskip
\section{引~~~~言}
    自动微分是指自动获取一个目标计算机程序导数的技术。很多人了解它是因为它在机器学习中的成功应用，人们可以用它优化带有千亿参数的神经元网络~\cite{Rosset2019}。
与很多人印象不同的是，自动微分其实是个很古老的技术。
Nolan曾在他1953年的博士论文中就提出过~\cite{Nolan1953}自动化求导计算机程序的构想，
它利用了计算机程序的一个普遍特性，那就是不管程序有多么复杂，总可以被分解成一些基础函数。
当知晓基础函数的自动微分规则，我们总可以通过链式法则推导出整个程序的导数。
    在上世纪60年代，自动微分发展出了两种不同的实践，一种叫做前向传播（Forward propagation）~\cite{Wengert1964}，一种叫做后向传播（Backward propagation）~\cite{Boltyanski1960}。
为了直观的理解它们的不同，这里考虑一个计算过程 $f : \mathbb{R}^m \rightarrow \mathbb{R}^n$
\begin{align*}
    &\vx^1 = f_1(\vx^0)\\
    &\vx^2 = f_2(\vx^1)\\
    &\ldots\\
    &\vx^L = f_L(\vx^{L-1})
\end{align*}
其中 $x^0\in R^m$, $x^L\in R^n$, $L$是计算的步骤数。
这段程序的雅可比 (Jacobian) 矩阵$J_{ij} \equiv \frac{\partial x^L_i}{\partial x_j^0}$是一个$n\times m$的矩阵，其中$x_j^0$和$x_i^L$代表了输入和输出中的一个元素。
前向自动微分的链式法则表述为$\frac{\partial \vx^k}{\partial x^0_j} = \frac{\partial \vx^k}{\partial \vx^{k-1}}\frac{\partial \vx^{k-1}}{\partial x^0_j}$，它计算了雅可比矩阵的第$j$列。后向自动微分的链式法则为$\frac{\partial \vx^L_i}{\partial x^{k-1}} = \frac{\partial \vx^L_i}{\partial \vx^{k}}\frac{\partial \vx^{k}}{\partial x^{k-1}}$，它计算了雅可比矩阵的第$i$行。
在大多数应用中，计算一行雅可比矩阵比计算一列有用的多，因为
后向自动微分的实现难度远高于前向自动微分，因为它的梯度计算方向和计算本身的方向相反，而计算梯度的过程中需要知道计算的运行状态（如函数的输入），最直接的方式便是记录所有后向传播中需要用到的中间结果。

NOTE: add an illustration of forward AD and reverse AD. Change column/row to Jv and vJ.

    后向自动微分的实现分为“狭义”和“广义”两种。狭义的是说，像很多传统机器学习库PyTorch和TensorFlow中所做的那样，对一些神经元网络中常用的函数族（矩阵乘法，卷积函数，relu函数等）定义导数传递规则，并通过上述链式法则求得整个程序的导数。
这样做可以对函数有针对性的优化，尤其是可以保证张量运算的性能。
缺点是，科学计算的研究中，对求导函数的需求往往很多元化，上述函数族并不能解决人们所有的对求导的需求。有些时候人们可以通过添加一些求导规则来实现对程序的求导，比如在张量网络等模拟中需要用到的复数奇异值分解函数\cite{Wan2019,Liao2019}，模拟变分量子算法中幺正量子线路的求导~\cite{Luo2019}。
但是也有一些时候，添加求导规则也无济于事，比如，严格对教化求解基态过程中用到的极大极小本正值求解器~\cite{Xie2020}里面对稀疏矩阵构造过程的求导就不太容易指定。
这时候，人们需要对一段通用的，包括控制流的代码求导，也就是广义的自动微分。

    章节\ref{sec:timespace}介绍了自动微分中最为核心的时间和空间交换的理论，了解它可以使得研究者可以更加清楚自动微分的背后的原理，从而更好的解决目标问题。
    章节\ref{sec:applications}介绍了地震波模拟和自旋玻璃最优构型求解这两个应用。

    \section{时间与空间的权衡}\label{sec:timespace}
后向自动微分就都有一个无法避免的共同问题，那就是时间和空间的权衡。


\section{自动微分在物理中的应用}\label{sec:applications}
\vskip 1.55\baselineskip
\subsection{地震波的模拟}

\vskip 1.55\baselineskip
\subsection{热带（Tropical）张量网络求解自旋玻璃最优构型}
热带张量网络是张量网络的一个特别的应用，它重新定义了张量中基础元素的代数为
\begin{eqnarray}
x \oplus y  = \max(x, y),\,\,\,\,\,\,\,\,\,\,\,\, \,\,\,\,
x \odot y   =  x + y. \label{eq:max-sum-alg}
\end{eqnarray}
\begin{figure}[t]
\centering
\includegraphics[width=\columnwidth]{./transform12.pdf}
    \caption{正方晶格上的自旋玻璃问题，(a)对应的热带张量网络表示。(b)对应的“量子线路”表示。\label{fig:performance}} 
\end{figure}
如果我们将张量中的元素定义为自旋玻璃的耦合强度，我们就可以通过收缩这个张量结构得到自旋玻璃的最优构型。
这个最优构型的能量表达式为
\begin{equation}
    E(\{\sigma\}) = \max\limits_{\sigma}-\sum_{i < j }J_{ij} \sigma_i \sigma_j  - \sum_i h_i \sigma_i,
\label{eq:spinglassopt}
\end{equation}
    因此对它的微分就是。
但是作了这样的替换，张量收缩的微分规则就发生了变换。

\section{结~~~~论}

\section*{致谢}

感谢北京大学力学系某某教授和某某博士以及某某的讨论.


\section*{附录A1}

标题排列和编号方式为A1, A2, A3.

\section*{附录A2}
%
%text text
%
%\section*{附录B1}
%%\section*{附录B2}
%
%text text
%
%\section*{致谢}
%
%text text

\bigskip
%\begin{footnotesize}

\bibliographystyle{apsrev4-1}
\bibliography{invc}

\newpage

\title{English Title $^{\ast}$}%{\efundlink}

\efund{Project supported by the State Key Development Program for Basic Research of China (Grant No. 2011CB00000), the National Natural Science Foundation of China (Grant Nos. 123456, 567890), and the National High Technology Research and Development Program of China (Grant No. 2011AA06Z000). \\}


\author{Guan Yun-Chang$^{1)2)}$ \quad  Liu Bei$^{1)\dag}$ \quad  Zhuge Liang$^{2)}$}

\email{aaa@bbb.ccc  }
%\email \emailddag


\eaddress{1)}{State Key Laboratory of Quantum Optics and Quantum Optics  Devices,
Institute of Opto-Electronics, Shanxi University, Taiyuan 030006, China}

\eaddress{2)}{Department of Physics, Tsinghua University, Beijing 100084, China}

\eabstract{}

\small  To determine the probe made of amino acids arranged in a linear chain and joined together by peptide bonds between the carboxyl and amino groups of adjacent amino acid residues. The sequence of amino acids in a protein is defined by a gene and encoded in the genetic code. This can happen either
before the protein is used in the cell, or as part of control mechanisms.

\ekeywords{Keyword1, Keyword2, Keyword3, Keyword4 \\}

\epacs{02.10.Yn, 33.15.Vb, 98.52.Cf, 78.47.dc}

\end{document}
